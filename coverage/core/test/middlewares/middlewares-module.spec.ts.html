<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for core/test/middlewares/middlewares-module.spec.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\..\..\prettify.css" />
    <link rel="stylesheet" href="..\..\..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\..\..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\..\..\index.html">All files</a> / <a href="index.html">core/test/middlewares</a> middlewares-module.spec.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>59/59</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/0</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">72.73% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>8/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>55/55</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { expect } from "chai";
import * as sinon from "sinon";
import { Middleware } from "../../middlewares/interfaces/middleware.interface";
import { Component } from "../../../common/utils/component.decorator";
import { MiddlewareBuilder } from "../../middlewares/builder";
import { MiddlewaresModule } from "../../middlewares/middlewares-module";
import { UnkownMiddlewareException } from "../../../errors/exceptions/unkown-middleware.exception";
import { InvalidMiddlewareException } from "../../../errors/exceptions/invalid-middleware.exception";
import { RequestMethod } from "../../../common/enums/request-method.enum";
import { Controller } from "../../../common/utils/controller.decorator";
import { RequestMapping } from "../../../common/utils/request-mapping.decorator";
&nbsp;
describe('MiddlewaresModule', () =&gt; {
    @Controller({ path: "test" })
    class AnotherRoute { }
&nbsp;
    @Controller({ path: "test" })
    class TestRoute {
&nbsp;
        @RequestMapping({ path: "test" })
<span class="fstat-no" title="function not covered" >        getTest</span>() {}
&nbsp;
        @RequestMapping({ path: "another", method: RequestMethod.DELETE })
<span class="fstat-no" title="function not covered" >        getAnother</span>() {}
    }
&nbsp;
    @Component()
    class TestMiddleware implements Middleware {
        resolve() {
            return <span class="fstat-no" title="function not covered" >(r</span>eq, res, next) =&gt; {}
        }
    }
&nbsp;
    describe('loadConfiguration', () =&gt; {
&nbsp;
        it('should call "configure" method if method is implemented', () =&gt; {
            const configureSpy = sinon.spy();
            const mockModule = {
                configure: configureSpy
            };
&nbsp;
            MiddlewaresModule.loadConfiguration(&lt;any&gt;mockModule, &lt;any&gt;"Test");
&nbsp;
            expect(configureSpy.calledOnce).to.be.true;
            expect(configureSpy.calledWith(new MiddlewareBuilder())).to.be.true;
        });
    });
&nbsp;
    describe('setupRouteMiddleware', () =&gt; {
&nbsp;
        it('should throw "UnkownMiddlewareException" exception when middlewares is not stored in container', () =&gt; {
            const route = { path: "Test" };
            const configuration = {
                middlewares: [ TestMiddleware ],
                forRoutes: [ TestRoute ]
            };
&nbsp;
            const useSpy = sinon.spy();
            const app = { use: useSpy };
&nbsp;
            expect(MiddlewaresModule.setupRouteMiddleware.bind(
                MiddlewaresModule, route, configuration, &lt;any&gt;"Test", &lt;any&gt;app
            )).throws(UnkownMiddlewareException);
        });
&nbsp;
        it('should throw "InvalidMiddlewareException" exception when middlewares does not have "resolve" method', () =&gt; {
            @Component()
            class InvalidMiddleware {}
&nbsp;
            const route = { path: "Test" };
            const configuration = {
                middlewares: [ InvalidMiddleware ],
                forRoutes: [ TestRoute ]
            };
&nbsp;
            const useSpy = sinon.spy();
            const app = { use: useSpy };
&nbsp;
            const container = MiddlewaresModule.getContainer();
            const moduleKey = &lt;any&gt;"Test";
            container.addConfig([ &lt;any&gt;configuration ], moduleKey);
&nbsp;
            const instance = new InvalidMiddleware();
            container.getMiddlewares(moduleKey).set(&lt;any&gt;InvalidMiddleware, &lt;any&gt;instance);
&nbsp;
            expect(MiddlewaresModule.setupRouteMiddleware.bind(
                MiddlewaresModule, route, configuration, moduleKey, &lt;any&gt;app
            )).throws(InvalidMiddlewareException);
        });
&nbsp;
        it('should store middlewares when middleware is stored in container', () =&gt; {
            const route = { path: "Test", method: RequestMethod.GET };
            const configuration = {
                middlewares: [ TestMiddleware ],
                forRoutes: [ { path: "test" }, AnotherRoute, TestRoute ]
            };
&nbsp;
            const useSpy = sinon.spy();
            const app = {
                get: useSpy
            };
&nbsp;
            const container = MiddlewaresModule.getContainer();
            const moduleKey = &lt;any&gt;"Test";
            container.addConfig([ configuration ], moduleKey);
&nbsp;
            const instance = new TestMiddleware();
            container.getMiddlewares(moduleKey).set(TestMiddleware, instance);
&nbsp;
            MiddlewaresModule.setupRouteMiddleware(route, configuration, moduleKey, &lt;any&gt;app);
            expect(useSpy.calledOnce).to.be.true;
        });
&nbsp;
    });
&nbsp;
});</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Feb 10 2017 19:35:41 GMT+0100 (Środkowoeuropejski czas stand.)
</div>
</div>
<script src="..\..\..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\..\..\sorter.js"></script>
</body>
</html>
