<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for core/injector/injector.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\..\prettify.css" />
    <link rel="stylesheet" href="..\..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\..\index.html">All files</a> / <a href="index.html">core/injector</a> injector.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">50.94% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>27/53</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">34.62% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>9/26</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">57.14% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>8/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">51.92% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>27/52</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import "reflect-metadata";
import { ModuleDependencies, InstanceWrapper } from "./container";
import { Middleware } from "../middlewares/interfaces/middleware.interface";
import { CircularDependencyException } from "../../errors/exceptions/circular-dependency.exception";
import { UnkownDependenciesException } from "../../errors/exceptions/unkown-dependencies.exception";
import { MiddlewareProto } from "../middlewares/interfaces/middleware-proto.interface";
import { RuntimeException } from "../../errors/exceptions/runtime.exception";
&nbsp;
export class Injector {
&nbsp;
<span class="fstat-no" title="function not covered" >    loadInstanceOfMiddleware</span>(
        middlewareType,
        collection: Map&lt;MiddlewareProto, Middleware&gt;,
        module: ModuleDependencies) {
&nbsp;
        const currentFetchedMiddleware = <span class="cstat-no" title="statement not covered" >collection.get(middlewareType);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(currentFetchedMiddleware === null) {</span>
<span class="cstat-no" title="statement not covered" >            this.resolveConstructorParams(middlewareType, module, <span class="fstat-no" title="function not covered" >(a</span>rgsInstances) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >                collection.set(middlewareType, new middlewareType(...argsInstances))</span>
            });
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    loadInstanceOfRoute</span>(routeType, module: ModuleDependencies) {
        const routes = <span class="cstat-no" title="statement not covered" >module.routes;</span>
<span class="cstat-no" title="statement not covered" >        this.loadInstance(routeType, routes, module);</span>
    }
&nbsp;
    loadPrototypeOfInstance&lt;T&gt;(type, collection: Map&lt;T, InstanceWrapper&lt;T&gt;&gt;) {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (!collection) { <span class="cstat-no" title="statement not covered" >return; </span>}
&nbsp;
        collection.set(type, {
            ...collection.get(type),
            instance: Object.create(type.prototype),
        });
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    loadInstanceOfComponent</span>(componentType, module: ModuleDependencies) {
        const components = <span class="cstat-no" title="statement not covered" >module.components;</span>
<span class="cstat-no" title="statement not covered" >        this.loadInstance(componentType, components, module);</span>
    }
&nbsp;
    loadInstance(type, collection, module: ModuleDependencies) {
        const currentFetchedInstance = collection.get(type);
        if (typeof currentFetchedInstance === 'undefined') {
            throw new RuntimeException('');
        }
        <span class="missing-if-branch" title="else path not taken" >E</span>if (!currentFetchedInstance.isResolved) {
            this.resolveConstructorParams(type, module, (argsInstances) =&gt; {
                currentFetchedInstance.instance = Object.assign(
                    currentFetchedInstance.instance,
                    new type(...argsInstances),
                );
                currentFetchedInstance.isResolved = true;
            });
        }
    }
&nbsp;
    private resolveConstructorParams(type, module, callback) {
        let constructorParams = Reflect.getMetadata('design:paramtypes', type) || <span class="branch-1 cbranch-no" title="branch not covered" >[];</span>
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if ((&lt;any&gt;type).dependencies) {
<span class="cstat-no" title="statement not covered" >            constructorParams = (&lt;any&gt;type).dependencies;</span>
        }
        const argsInstances = constructorParams.map((param) =&gt; (
            this.resolveSingleParam(type, param, module)
        ));
        callback(argsInstances);
    }
&nbsp;
    private resolveSingleParam(targetType, param, module: ModuleDependencies) {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof param === 'undefined') {
<span class="cstat-no" title="statement not covered" >            throw new CircularDependencyException(targetType);</span>
        }
&nbsp;
        return this.resolveComponentInstance(module, param, targetType);
    }
&nbsp;
    private resolveComponentInstance(module: ModuleDependencies, param, componentType) {
        const components = module.components;
        const instanceWrapper = this.scanForComponent(components, param, module, componentType);
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (instanceWrapper.instance === null) {
<span class="cstat-no" title="statement not covered" >            this.loadInstanceOfComponent(param, module);</span>
        }
        return instanceWrapper.instance;
    }
&nbsp;
    private scanForComponent(components, param, module, componentType) {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (!components.has(param)) {
            const instanceWrapper = <span class="cstat-no" title="statement not covered" >this.scanForComponentInRelatedModules(module, param);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (instanceWrapper === null) {</span>
<span class="cstat-no" title="statement not covered" >                throw new UnkownDependenciesException(componentType);</span>
            }
<span class="cstat-no" title="statement not covered" >            return instanceWrapper;</span>
        }
        return components.get(param);
    }
&nbsp;
    private <span class="fstat-no" title="function not covered" >scanForComponentInRelatedModules</span>(module: ModuleDependencies, componentType) {
        const relatedModules = <span class="cstat-no" title="statement not covered" >module.relatedModules;</span>
        let component = <span class="cstat-no" title="statement not covered" >null;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        relatedModules.forEach(<span class="fstat-no" title="function not covered" >(r</span>elatedModule) =&gt; {</span>
            const { components, exports } = <span class="cstat-no" title="statement not covered" >relatedModule;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (!exports.has(componentType) || !components.has(componentType)) {</span>
<span class="cstat-no" title="statement not covered" >                return;</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            component = components.get(componentType);</span>
<span class="cstat-no" title="statement not covered" >            if (!component.isResolved) {</span>
<span class="cstat-no" title="statement not covered" >                this.loadInstanceOfComponent(componentType, relatedModule);</span>
            }
        });
<span class="cstat-no" title="statement not covered" >        return component;</span>
    }
&nbsp;
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Feb 10 2017 19:35:41 GMT+0100 (Środkowoeuropejski czas stand.)
</div>
</div>
<script src="..\..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\..\sorter.js"></script>
</body>
</html>
